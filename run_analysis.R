```{r}
library(dplyr)
library(tidyr)
library(curl)
library(reshape2)
```

```{r}
filename <- "getdata_projectfiles.zip"
```
## Download and unzip the dataset:
```{r}
if(!file.exists(filename)){
  fileUrl <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
  download.file(fileUrl, filename, method = "curl")
}

if(!file.exists("UCI HAR Dataset")){
  unzip(filename)
}

# recording the date for downloading datasets
downloadedData <- date()
downloadedData

list.files()

```
# Load activity labels + features
```{r}
setwd("C:/Users/hanwe/Documents/Datasciencecoursera/Getting_and_Cleaning_Course/Project/UCI HAR Dataset")

# read train data
train_data <- read.table("train/X_train.txt")
train_label <- read.table("train/y_train.txt")
train_subject <- read.table("train/subject_train.txt")

# read test data
test_data <- read.table("test/X_test.txt")
test_label <- read.table("test/y_test.txt")
test_subject <- read.table("test/subject_test.txt")

```
# read feature file
```{r}
variable_names <- read.table("./UCI HAR Dataset/features.txt")
variable_names <- tbl_df(variable_names)
head(variable_names)
```
# read activity_labels file
```{r}
activity_labels <- read.table("./UCI HAR Dataset/activity_labels.txt")
activity_labels <- tbl_df(activity_labels)
tail(activity_labels)

```
#The first thing to do is to create a uniform data set out of the available datasets in the site. We #have two datasets for the training data and its corresponding labels, and two datasets for the test #data and its corresponding labels. The following code will combine these datasets and will convert the #label(type of the activity) column into the factor form 
```{r}
col_names <- readLines("./UCI HAR Dataset/features.txt")
colnames(train_data)<-make.names(col_names)
colnames(test_data)<-make.names(col_names)

colnames(train_subject) <- "subjectID"
colnames(test_subject) <- "subjectID"

colnames(train_label)<-"activityID"
colnames(test_label)<-"activityID"

colnames(activity_labels) <- c("activityID", "activityType")
```

# 1. Merges the training and the test sets to create one data set.
```{r}
train_total <- cbind(train_subject,train_label,train_data)

test_total <- cbind(test_subject,test_label,test_data)

final_data <- rbind(train_total, test_total)

final_data <- tbl_df(final_data)

head(final_data)
```
# 2.Extracts only the measurements on the mean and standard deviation for each measurement.
```{r}
sub_data <- final_data %>% select(contains("subjectID"),contains("activityID"),contains(".mean."),contains(".std."))

head(sub_data)
```
# 3.Uses descriptive activity names to name the activities in the data set
```{r}
final_data$activityID[final_data$activityID == 1] <- "walking"
final_data$activityID[final_data$activityID == 2] <- "walking upstairs"
final_data$activityID[final_data$activityID == 3] <- "walking downstairs"
final_data$activityID[final_data$activityID == 4] <- "sitting"
final_data$activityID[final_data$activityID == 5] <- "standing"
final_data$activityID[final_data$activityID == 6] <- "laying"

head(final_data)
tail(final_data)

head(sub_data)
tail(sub_data)
```
# 4.Appropriately labels the data set with descriptive variable names.
```{r}
names(final_data) <- gsub("Acc", "Accelerometer", fixed = TRUE, names(final_data)) 
names(final_data)<-gsub("Gyro", "Gyroscope", fixed = TRUE,names(final_data))
names(final_data)<-gsub("BodyBody", "Body", fixed = TRUE,names(final_data))
names(final_data)<-gsub("Mag", "Magnitude", fixed = TRUE,names(final_data))
names(final_data)<-gsub("^t", "Time", fixed = TRUE,names(final_data))
names(final_data)<-gsub("^f", "Frequency", fixed = TRUE,names(final_data))
names(final_data)<-gsub("tBody", "TimeBody", fixed = TRUE,names(final_data))
names(final_data)<-gsub("-mean()", "Mean", fixed = TRUE,names(final_data), ignore.case = TRUE)
names(final_data)<-gsub("-std()", "STD", fixed = TRUE,names(final_data), ignore.case = TRUE)
names(final_data)<-gsub("-freq()", "Frequency", fixed = TRUE,names(final_data), ignore.case = TRUE)
names(final_data)<-gsub("angle", "Angle", fixed = TRUE,names(final_data))
names(final_data)<-gsub("gravity", "Gravity", fixed = TRUE,names(final_data))

head(final_data)
```
#5.From the data set in step 4, creates a second, independent tidy data set with the average of each variable for each activity and each subject.
```{r}
TidyData <- final_data %>%
    group_by(subjectID, activityID) %>%
    summarise_all(funs(mean))
write.table(TidyData, "TidyData.txt", row.name=FALSE)
```
``{r}
str(TidyData)
```
Classes ‘grouped_df’, ‘tbl_df’, ‘tbl’ and 'data.frame':	180 obs. of  563 variables:
 $ subjectID                                             : int  1 1 1 1 1 1 2 2 2 2 ...
 $ activityID                                            : chr  "laying" "sitting" "standing" "walking" ...
 $ X1.TimeBodyAccelerometer.mean...X                     : num  0.222 0.261 0.279 0.277 0.289 ...
 $ X2.TimeBodyAccelerometer.mean...Y                     : num  -0.04051 -0.00131 -0.01614 -0.01738 -0.00992 ...
 $ X3.TimeBodyAccelerometer.mean...Z                     : num  -0.113 -0.105 -0.111 -0.111 -0.108 ...
 $ X4.TimeBodyAccelerometer.std...X                      : num  -0.928 -0.977 -0.996 -0.284 0.03 ...
 $ X5.TimeBodyAccelerometer.std...Y                      : num  -0.8368 -0.9226 -0.9732 0.1145 -0.0319 ...
 $ X6.TimeBodyAccelerometer.std...Z                      : num  -0.826 -0.94 -0.98 -0.26 -0.23 ...
 $ X7.TimeBodyAccelerometer.mad...X                      : num  -0.9321 -0.9795 -0.9961 -0.3407 -0.0441 ...
 $ X8.TimeBodyAccelerometer.mad...Y                      : num  -0.8409 -0.9197 -0.9718 0.0618 -0.1074 ...
 $ X9.TimeBodyAccelerometer.mad...Z                      : num  -0.822 -0.939 -0.979 -0.25 -0.212 ...
 $ X10.TimeBodyAccelerometer.max...X                     : num  -0.906 -0.927 -0.939 -0.103 0.389 ...
 $ X11.TimeBodyAccelerometer.max...Y                     : num  -0.5016 -0.5174 -0.5609 -0.0557 -0.0953 ...
 $ X12.TimeBodyAccelerometer.max...Z                     : num  -0.703 -0.786 -0.813 -0.255 -0.317 ...
 $ X13.TimeBodyAccelerometer.min...X                     : num  0.7431 0.8203 0.8489 0.1196 0.0157 ...
 $ X14.TimeBodyAccelerometer.min...Y                     : num  0.5849 0.6828 0.685 -0.0212 -0.0437 ...
 $ X15.TimeBodyAccelerometer.min...Z                     : num  0.758 0.822 0.838 0.437 0.305 ...
 $ X16.TimeBodyAccelerometer.sma..                       : num  -0.842 -0.946 -0.984 -0.126 0.008 ...
 $ X17.TimeBodyAccelerometer.energy...X                  : num  -0.984 -0.998 -1 -0.739 -0.463 ...
 $ X18.TimeBodyAccelerometer.energy...Y                  : num  -0.948 -0.99 -0.999 -0.758 -0.813 ...
 $ X19.TimeBodyAccelerometer.energy...Z                  : num  -0.905 -0.987 -0.999 -0.748 -0.724 ...
 $ X20.TimeBodyAccelerometer.iqr...X                     : num  -0.94 -0.983 -0.996 -0.424 -0.225 ...
 $ X21.TimeBodyAccelerometer.iqr...Y                     : num  -0.877 -0.932 -0.974 -0.299 -0.399 ...
 $ X22.TimeBodyAccelerometer.iqr...Z                     : num  -0.823 -0.943 -0.979 -0.252 -0.206 ...
 $ X23.TimeBodyAccelerometer.entropy...X                 : num  -0.372 -0.594 -0.654 0.359 0.237 ...
 $ X24.TimeBodyAccelerometer.entropy...Y                 : num  -0.491 -0.399 -0.563 0.437 0.376 ...
 $ X25.TimeBodyAccelerometer.entropy...Z                 : num  -0.402 -0.5213 -0.5895 0.0424 0.1697 ...
 $ X26.TimeBodyAccelerometer.arCoeff...X.1               : num  0.043 0.152 0.297 -0.335 -0.395 ...
 $ X27.TimeBodyAccelerometer.arCoeff...X.2               : num  0.00523 -0.05942 -0.14551 0.34841 0.36759 ...
 $ X28.TimeBodyAccelerometer.arCoeff...X.3               : num  -0.0323 0.041 0.1136 -0.1492 -0.31 ...
 $ X29.TimeBodyAccelerometer.arCoeff...X.4               : num  0.14657 -0.00412 0.0807 0.07994 0.2763 ...
 $ X30.TimeBodyAccelerometer.arCoeff...Y.1               : num  0.176 0.169 0.185 -0.167 -0.121 ...
 $ X31.TimeBodyAccelerometer.arCoeff...Y.2               : num  -0.104 -0.129 -0.138 0.175 0.155 ...
 $ X32.TimeBodyAccelerometer.arCoeff...Y.3               : num  0.1842 0.1851 0.1903 0.1678 0.0867 ...
 $ X33.TimeBodyAccelerometer.arCoeff...Y.4               : num  0.0105 -0.117 -0.0158 -0.0514 0.0377 ...
 $ X34.TimeBodyAccelerometer.arCoeff...Z.1               : num  0.2091 0.2589 0.2799 -0.1189 0.0804 ...
 $ X35.TimeBodyAccelerometer.arCoeff...Z.2               : num  -0.1219 -0.1171 -0.1279 0.1673 0.0878 ...
 $ X36.TimeBodyAccelerometer.arCoeff...Z.3               : num  0.09054 0.08508 0.11685 0.00262 0.02916 ...
 $ X37.TimeBodyAccelerometer.arCoeff...Z.4               : num  0.00239 -0.02272 -0.10391 -0.27517 -0.2914 ...
 $ X38.TimeBodyAccelerometer.correlation...X.Y           : num  -0.0409 -0.4029 0.1284 -0.1437 -0.4542 ...
 $ X39.TimeBodyAccelerometer.correlation...X.Z           : num  -0.00933 -0.20119 -0.00543 -0.19123 -0.22554 ...
 $ X40.TimeBodyAccelerometer.correlation...Y.Z           : num  -0.0234 0.1183 0.2883 0.3802 0.0757 ...
 $ X41.tGravityAccelerometer.mean...X                    : num  -0.249 0.832 0.943 0.935 0.932 ...
 $ X42.tGravityAccelerometer.mean...Y                    : num  0.706 0.204 -0.273 -0.282 -0.267 ...
 $ X43.tGravityAccelerometer.mean...Z                    : num  0.4458 0.332 0.0135 -0.0681 -0.0621 ...
 $ X44.tGravityAccelerometer.std...X                     : num  -0.897 -0.968 -0.994 -0.977 -0.951 ...
 $ X45.tGravityAccelerometer.std...Y                     : num  -0.908 -0.936 -0.981 -0.971 -0.937 ...
 $ X46.tGravityAccelerometer.std...Z                     : num  -0.852 -0.949 -0.976 -0.948 -0.896 ...
 $ X47.tGravityAccelerometer.mad...X                     : num  -0.899 -0.969 -0.994 -0.977 -0.951 ...
 $ X48.tGravityAccelerometer.mad...Y                     : num  -0.91 -0.938 -0.981 -0.972 -0.938 ...
 $ X49.tGravityAccelerometer.mad...Z                     : num  -0.855 -0.95 -0.977 -0.95 -0.898 ...
 $ X50.tGravityAccelerometer.max...X                     : num  -0.28 0.768 0.87 0.869 0.876 ...
 $ X51.tGravityAccelerometer.max...Y                     : num  0.685 0.188 -0.288 -0.294 -0.27 ...
 $ X52.tGravityAccelerometer.max...Z                     : num  0.4694 0.3319 0.0097 -0.0629 -0.0465 ...
 $ X53.tGravityAccelerometer.min...X                     : num  -0.236 0.843 0.961 0.947 0.936 ...
 $ X54.tGravityAccelerometer.min...Y                     : num  0.692 0.205 -0.248 -0.26 -0.256 ...
 $ X55.tGravityAccelerometer.min...Z                     : num  0.41387 0.32184 0.00938 -0.07849 -0.0863 ...
 $ X56.tGravityAccelerometer.sma..                       : num  0.248 0.225 -0.244 -0.142 -0.206 ...
 $ X57.tGravityAccelerometer.energy...X                  : num  -0.907 0.575 0.846 0.826 0.817 ...
 $ X58.tGravityAccelerometer.energy...Y                  : num  0.165 -0.88 -0.862 -0.864 -0.879 ...
 $ X59.tGravityAccelerometer.energy...Z                  : num  -0.32 -0.779 -0.995 -0.986 -0.988 ...
 $ X60.tGravityAccelerometer.iqr...X                     : num  -0.906 -0.972 -0.994 -0.978 -0.953 ...
 $ X61.tGravityAccelerometer.iqr...Y                     : num  -0.916 -0.944 -0.981 -0.973 -0.941 ...
 $ X62.tGravityAccelerometer.iqr...Z                     : num  -0.863 -0.954 -0.978 -0.955 -0.907 ...
 $ X63.tGravityAccelerometer.entropy...X                 : num  -0.518 -0.686 -0.886 -0.667 -0.445 ...
 $ X64.tGravityAccelerometer.entropy...Y                 : num  -0.554 -0.489 -1 -1 -1 ...
 $ X65.tGravityAccelerometer.entropy...Z                 : num  -0.58 -0.626 -0.852 -0.993 -0.98 ...
 $ X66.tGravityAccelerometer.arCoeff...X.1               : num  -0.594 -0.53 -0.383 -0.298 -0.571 ...
 $ X67.tGravityAccelerometer.arCoeff...X.2               : num  0.609 0.543 0.404 0.383 0.63 ...
 $ X68.tGravityAccelerometer.arCoeff...X.3               : num  -0.625 -0.555 -0.425 -0.464 -0.688 ...
 $ X69.tGravityAccelerometer.arCoeff...X.4               : num  0.64 0.568 0.447 0.543 0.745 ...
 $ X70.tGravityAccelerometer.arCoeff...Y.1               : num  -0.3854 -0.4613 -0.394 0.0308 -0.2103 ...
 $ X71.tGravityAccelerometer.arCoeff...Y.2               : num  0.3503 0.414 0.3507 0.0226 0.2307 ...
 $ X72.tGravityAccelerometer.arCoeff...Y.3               : num  -0.356 -0.401 -0.347 -0.147 -0.307 ...
 $ X73.tGravityAccelerometer.arCoeff...Y.4               : num  0.378 0.404 0.36 0.296 0.403 ...
 $ X74.tGravityAccelerometer.arCoeff...Z.1               : num  -0.542 -0.449 -0.393 -0.251 -0.204 ...
 $ X75.tGravityAccelerometer.arCoeff...Z.2               : num  0.557 0.467 0.408 0.275 0.223 ...
 $ X76.tGravityAccelerometer.arCoeff...Z.3               : num  -0.571 -0.484 -0.424 -0.297 -0.241 ...
 $ X77.tGravityAccelerometer.arCoeff...Z.4               : num  0.583 0.498 0.436 0.314 0.256 ...
 $ X78.tGravityAccelerometer.correlation...X.Y           : num  -0.0846 -0.7392 0.4726 0.3214 0.2295 ...
 $ X79.tGravityAccelerometer.correlation...X.Z           : num  -0.0781 -0.4975 0.1378 -0.0401 -0.2974 ...
 $ X80.tGravityAccelerometer.correlation...Y.Z           : num  -0.209 0.301 0.47 0.281 0.101 ...
 $ X81.TimeBodyAccelerometerJerk.mean...X                : num  0.0811 0.0775 0.0754 0.074 0.0542 ...
 $ X82.TimeBodyAccelerometerJerk.mean...Y                : num  0.003838 -0.000619 0.007976 0.028272 0.02965 ...
 $ X83.TimeBodyAccelerometerJerk.mean...Z                : num  0.01083 -0.00337 -0.00369 -0.00417 -0.01097 ...
 $ X84.TimeBodyAccelerometerJerk.std...X                 : num  -0.9585 -0.9864 -0.9946 -0.1136 -0.0123 ...
 $ X85.TimeBodyAccelerometerJerk.std...Y                 : num  -0.924 -0.981 -0.986 0.067 -0.102 ...
 $ X86.TimeBodyAccelerometerJerk.std...Z                 : num  -0.955 -0.988 -0.992 -0.503 -0.346 ...
 $ X87.TimeBodyAccelerometerJerk.mad...X                 : num  -0.96363 -0.98773 -0.99478 -0.1022 -0.00217 ...
 $ X88.TimeBodyAccelerometerJerk.mad...Y                 : num  -0.9337 -0.9808 -0.9841 0.0859 -0.0851 ...
 $ X89.TimeBodyAccelerometerJerk.mad...Z                 : num  -0.959 -0.987 -0.991 -0.468 -0.316 ...
 $ X90.TimeBodyAccelerometerJerk.max...X                 : num  -0.957 -0.986 -0.994 -0.291 -0.17 ...
 $ X91.TimeBodyAccelerometerJerk.max...Y                 : num  -0.944 -0.988 -0.99 -0.314 -0.388 ...
 $ X92.TimeBodyAccelerometerJerk.max...Z                 : num  -0.958 -0.988 -0.992 -0.672 -0.486 ...
 $ X93.TimeBodyAccelerometerJerk.min...X                 : num  0.948 0.984 0.992 -0.03 -0.061 ...
 $ X94.TimeBodyAccelerometerJerk.min...Y                 : num  0.9266 0.9841 0.9895 0.0992 0.2839 ...
 $ X95.TimeBodyAccelerometerJerk.min...Z                 : num  0.93 0.985 0.989 0.434 0.348 ...
 $ X96.TimeBodyAccelerometerJerk.sma..                   : num  -0.9536 -0.9872 -0.9926 -0.1257 -0.0774 ...
 $ X97.TimeBodyAccelerometerJerk.energy...X              : num  -0.996 -0.999 -1 -0.6 -0.505 ...
  [list output truncated]
 - attr(*, "groups")=Classes ‘tbl_df’, ‘tbl’ and 'data.frame':	30 obs. of  2 variables:
  ..$ subjectID: int  1 2 3 4 5 6 7 8 9 10 ...
  ..$ .rows    :List of 30
  .. ..$ : int  1 2 3 4 5 6
  .. ..$ : int  7 8 9 10 11 12
  .. ..$ : int  13 14 15 16 17 18
  .. ..$ : int  19 20 21 22 23 24
  .. ..$ : int  25 26 27 28 29 30
  .. ..$ : int  31 32 33 34 35 36
  .. ..$ : int  37 38 39 40 41 42
  .. ..$ : int  43 44 45 46 47 48
  .. ..$ : int  49 50 51 52 53 54
  .. ..$ : int  55 56 57 58 59 60
  .. ..$ : int  61 62 63 64 65 66
  .. ..$ : int  67 68 69 70 71 72
  .. ..$ : int  73 74 75 76 77 78
  .. ..$ : int  79 80 81 82 83 84
  .. ..$ : int  85 86 87 88 89 90
  .. ..$ : int  91 92 93 94 95 96
  .. ..$ : int  97 98 99 100 101 102
  .. ..$ : int  103 104 105 106 107 108
  .. ..$ : int  109 110 111 112 113 114
  .. ..$ : int  115 116 117 118 119 120
  .. ..$ : int  121 122 123 124 125 126
  .. ..$ : int  127 128 129 130 131 132
  .. ..$ : int  133 134 135 136 137 138
  .. ..$ : int  139 140 141 142 143 144
  .. ..$ : int  145 146 147 148 149 150
  .. ..$ : int  151 152 153 154 155 156
  .. ..$ : int  157 158 159 160 161 162
  .. ..$ : int  163 164 165 166 167 168
  .. ..$ : int  169 170 171 172 173 174
  .. ..$ : int  175 176 177 178 179 180
  ..- attr(*, ".drop")= logi TRUE
